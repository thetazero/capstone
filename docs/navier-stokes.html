<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Navier Stokes Varient</title>
  <link rel="stylesheet" href="https://thetazero.github.io/style.css">
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="container">
    <h1>Navier Stokes Varient</h1>
    <hr>
    <span class="bad" id="loading">loading…</span>
    <p>
      Type in the inputs into the text boxes bellow, for ν just type in a number. For p and q type in a vector in
      this form [1, 2]. Depth determines the depth to which the continued fractions are approximated.
    </p>
    <p>
      <b>ν:</b><input type="text" id="nu-input" placeholder="ν" value="1">
      <b>p:</b><input type="text" id="p" placeholder="p vector" value="[3, 1]" onkeyup="setPQ()">
      <b>q:</b><input type="text" id="q" placeholder="q vector" value="[-1, 2]" onkeyup="setPQ()">
      <b>depth:</b><input type="text" id="debth" placeholder="debth" value="10">
      <input type="button" value="solve" onclick="solveBtn()">
    </p>
    <div id="vector-controls">

    </div>
    <div id="calculator" style="width:100%; height:min(50vw, 70vh)"></div>

  </div>
  <script src="https://www.desmos.com/api/v1.5/calculator.js?apiKey=dcb31709b452b1cf9dc26972add0fda6"></script>
  <script src="wasm_exec.js"></script>
  <script>
    let ready = false
    const go = new Go();
    let mod, inst;
    WebAssembly.instantiateStreaming(fetch("i0.wasm"), go.importObject).then(async result => {
      mod = result.module;
      inst = result.instance;
      ready = true
      await go.run(inst);
    });
  </script>
  <script>
    let p = [3, 1];
    let q = [-1, 2];

    function solveBtn() {
      let nu = parseFloat(document.querySelector("#nu-input").value)
      p = parseVector(document.querySelector("#p").value)
      q = parseVector(document.querySelector("#q").value)
      let debth = parseInt(document.querySelector("#debth").value)
      let result = solve_ns(nu, p, q, debth)
      console.log(result)

      resetCalc()
      let { ftop, fbot, fbotplus1, gtop, gbot, gbotplus1, p0 } = result
      let c = result['case']
      let bounds = "\\left\\{x\\ge0\\right\\}"
      if (c == 'i0' || c == 'i-') {
        calculator.setExpression({ id: 'graph1', latex: `f(x)=${makeRationalFunc(ftop, fbot)}${bounds}`, color: "#2d70b3" })
        calculator.setExpression({ id: 'f_error', latex: `${makeErrorBounds("f", fbot, fbotplus1)}${bounds}`, color: "#3d80c3" })
      }
      if (c == "i0" || c == "i+") {
        calculator.setExpression({ id: 'graph2', latex: `g(x)=${makeRationalFunc(gtop, gbot)}${bounds}`, color: "#fa7e19" })
        calculator.setExpression({ id: 'g_error', latex: `${makeErrorBounds("g", gbot, gbotplus1)}${bounds}`, color: "#ff8d19" })
      }
      if (c == "i0") {
        calculator.setExpression({ id: 'graph3', latex: `f(x)+g(x)+${PolynomialString(p0)}${bounds}`, color: "#000000" })
      } else if (c == "i+") {
        calculator.setExpression({ id: 'graph3', latex: `g(x)+${PolynomialString(p0)}${bounds}`, color: "#000000" })
      } else if (c == 'i-') {
        calculator.setExpression({ id: 'graph3', latex: `f(x)+${PolynomialString(p0)}${bounds}`, color: "#000000" })
      }
    }

    const calcElem = document.getElementById('calculator');
    const calculator = Desmos.GraphingCalculator(calcElem);
    calculator.updateSettings({
      projectorMode: true,
      invertedColors: true,
      expressionsCollapsed: true,
    })
    calculator.setMathBounds({
      left: -0.1,
      right: 5,
      bottom: -0.1,
      top: 1.2,
    })
    calculator.setDefaultState(calculator.getState())
  </script>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.1.9/lib/p5.js"></script>
  <script src="vectorControls.js"></script>
  <script src="shared.js"></script>
</body>

</html>